<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRT UI - Game Library</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables for CRT Theme - Centralized for consistency */
    :root {
      /* Light Mode Variables (Default) */
      --tv-frame-bg-start: #333;
      --tv-frame-bg-end: #111;
      --tv-frame-border: #050505;
      --tv-frame-shadow-inset: #000;
      --tv-frame-shadow-outset: #000;
      --screen-bg: #101010;
      --screen-glow-color: #0f0;
      --screen-text-color: lime;
      --knob-bg: #444;
      --knob-border: #888;
      --knob-shadow-dark: #000;
      --knob-shadow-light: #999;
      --power-light-on: red;
      --power-light-shadow: red;
      --button-bg: #666;
      --button-color: white;
      --crt-scanline-color: #0f05;
    }

    /* Dark Mode variables for the entire app */
    body.dark-mode {
      --tv-frame-bg-start: #111;
      --tv-frame-bg-end: #050505;
      --screen-bg: #050505;
      --screen-glow-color: #0c0; /* Slightly darker green for dark mode screen glow */
      --screen-text-color: #0c0; /* Slightly darker green for dark mode text */
      --button-bg: #444;
      --button-color: #eee; /* Lighter button text in dark mode */
      --tv-frame-border: #000; /* Darker border in dark mode */
      --knob-bg: #222; /* Darker knobs in dark mode */
      --knob-border: #555;
      --knob-shadow-dark: #000;
      --knob-shadow-light: #444;
      --power-light-on: darkred; /* Darker red for dark mode */
      --power-light-shadow: darkred;
      --crt-scanline-color: #0c05;
    }

    /* Global styles for CRT theme */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: var(--tv-frame-bg-end); /* Use a variable for background */
      font-family: 'Press Start 2P', 'Courier New', Courier, monospace;
      color: var(--screen-text-color);
      text-shadow: 0 0 5px var(--screen-text-color); /* Subtle text glow */
      transition: background 0.5s ease, color 0.5s ease, text-shadow 0.5s ease;
      overflow: hidden; /* Prevent scroll on main CRT page */
    }

    /* Scanlines effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        #00000000,
        #00000000 1px,
        var(--crt-scanline-color) 1px,
        var(--crt-scanline-color) 2px
      );
      pointer-events: none;
      opacity: 0.15;
      z-index: 1000;
      animation: scanlineAnimation 8s infinite linear;
    }

    @keyframes scanlineAnimation {
      from { background-position: 0 0; }
      to { background-position: 0 100%; }
    }

    /* CRT Glitch/Noise Overlay */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, rgba(0,255,0,0) 0%, rgba(0,255,0,0.1) 100%); /* Vignette effect */
      pointer-events: none;
      z-index: 999;
      opacity: 0.2;
    }

    /* --- Navigation Bar --- */
    .navbar {
        background: var(--screen-bg); /* Use screen background for navbar */
        backdrop-filter: blur(5px);
        padding: 15px 20px;
        border-bottom: 2px solid var(--tv-frame-border);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        display: flex;
        justify-content: center;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 10; /* Below scanlines, above CRT UI */
        transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
    }

    .navbar a {
        color: var(--screen-text-color);
        text-decoration: none;
        font-size: 1em;
        padding: 8px 15px;
        margin: 0 10px;
        border: 1px solid transparent;
        border-radius: 5px;
        transition: all 0.3s ease;
        text-shadow: 0 0 3px var(--screen-text-color);
    }

    .navbar a:hover, .navbar a.active {
        border-color: var(--screen-glow-color);
        box-shadow: 0 0 10px var(--screen-glow-color);
        background: rgba(0, 255, 0, 0.05); /* Subtle highlight */
    }

    /* --- CRT App Specific Styles --- */
    .tv-frame {
      position: relative;
      width: 95vw;
      max-width: 1200px;
      height: 90vh;
      max-height: 800px;
      background: radial-gradient(circle at center, var(--tv-frame-bg-start) 0%, var(--tv-frame-bg-end) 80%);
      border: 15px solid var(--tv-frame-border);
      border-radius: 25px;
      box-shadow: 
        inset 0 0 30px var(--tv-frame-shadow-inset), 
        0 0 60px var(--tv-frame-shadow-outset),
        10px 10px 20px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: auto; /* Center the TV frame */
      box-sizing: border-box;
      transition: all 0.5s ease;
      margin-top: calc(50% - 45vh + 70px); /* Adjust for navbar height (approx 70px) */
    }

    .screen {
      width: 85%;
      height: 70%;
      background: var(--screen-bg);
      box-shadow: 
        inset 0 0 15px var(--screen-glow-color), 
        0 0 40px var(--screen-glow-color);
      border-radius: 15px;
      padding: 1.5rem;
      color: var(--screen-text-color);
      overflow-y: auto;
      border: 2px solid var(--screen-glow-color);
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      text-align: center;
      transition: all 0.5s ease;
    }

    /* Screen "reflection" effect */
    .screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom right,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0) 50%,
        rgba(255, 255, 255, 0.05) 100%
      );
      border-radius: 15px;
      pointer-events: none;
    }

    .knob-panel {
      position: absolute;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2rem;
    }

    .knob {
      width: 60px;
      height: 60px;
      background: var(--knob-bg);
      border: 4px solid var(--knob-border);
      border-radius: 50%;
      box-shadow: 
        inset -5px -5px 10px var(--knob-shadow-dark), 
        inset 5px 5px 10px var(--knob-shadow-light),
        0 5px 10px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      position: relative;
    }

    .knob:hover {
      transform: translateY(-3px);
      box-shadow: 
        inset -5px -5px 10px var(--knob-shadow-dark), 
        inset 5px 5px 10px var(--knob-shadow-light),
        0 8px 15px rgba(0, 0, 0, 0.4);
    }

    .knob:active {
      transform: translateY(0);
      box-shadow: 
        inset 5px 5px 10px var(--knob-shadow-dark), 
        inset -5px -5px 10px var(--knob-shadow-light),
        0 3px 7px rgba(0, 0, 0, 0.2);
    }

    /* Knob indicator for rotation feel */
    .knob:not(.brightness-knob)::after { /* Apply to all except brightness knob */
      content: '';
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 15px;
      background: var(--knob-border);
      border-radius: 2px;
    }

    /* Specific style for the brightness knob */
    .knob.brightness-knob::after {
      content: 'ðŸ”†'; /* Sun/Moon icon for brightness */
      font-size: 20px;
      height: auto;
      background: none;
      color: var(--button-color); /* Matches button text color */
      text-shadow: none; /* No extra text shadow for icon */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      line-height: 1; /* Adjust line height for icon centering */
    }

    .power-light {
      position: absolute;
      bottom: 5%;
      right: 15%;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--power-light-on);
      box-shadow: 0 0 15px var(--power-light-shadow);
      animation: pulsate 1.5s infinite alternate;
    }

    @keyframes pulsate {
      from {
        opacity: 0.7;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1.05);
      }
    }

    .btn { /* This style is no longer used for the mode toggle, but kept if you add other buttons */
      margin-top: 1rem;
      padding: 10px 20px;
      background: var(--button-bg);
      color: var(--button-color);
      border: none;
      cursor: pointer;
      font-size: 1rem;
      border-radius: 5px;
      transition: background 0.2s ease, transform 0.1s ease, color 0.5s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }

    .btn:hover {
      background: #777;
      transform: translateY(-2px);
    }

    .btn:active {
      background: #444;
      transform: translateY(0);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body class="{% if isDark %}dark-mode{% endif %}"> <div class="navbar">
        <a href="/" class="nav-link active">Home</a>
        <a href="/library" class="nav-link">Library</a>
        <a href="/upload" class="nav-link">Upload Game</a>
        <a href="/settings" class="nav-link">Settings</a>
    </div>

    <div id="CRTApp" class="tv-frame"> <div class="power-light" v-if="isPowered"></div>

        <div class="screen">
            [[ content ]]
        </div>

        <div class="knob-panel">
            <div class="knob" @click="prevSystem"></div>
            <div class="knob" @click="nextSystem"></div>
            <div class="knob brightness-knob" @click="toggleMode"></div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        Vue.createApp({
            delimiters: ['[[', ']]'],
            data() {
                return {
                    // Initialize isDark from localStorage or default to false
                    isDark: localStorage.getItem('theme') === 'dark',
                    isPowered: true,
                    currentSystemIndex: 0,
                    systems: ['PS2', 'Dreamcast', 'GameCube', 'Xbox', 'Arcade'],
                };
            },
            computed: {
                content() {
                    return `Current System: ${this.systems[this.currentSystemIndex]}`;
                }
            },
            methods: {
                toggleMode() {
                    this.isDark = !this.isDark;
                    // Apply/remove the 'dark-mode' class on the body
                    document.body.classList.toggle('dark-mode', this.isDark);
                    // Save preference to localStorage
                    localStorage.setItem('theme', this.isDark ? 'dark' : 'light');
                },
                prevSystem() {
                    this.currentSystemIndex =
                        (this.currentSystemIndex - 1 + this.systems.length) % this.systems.length;
                },
                nextSystem() {
                    this.currentSystemIndex =
                        (this.currentSystemIndex + 1) % this.systems.length;
                }
            },
            mounted() {
                // Ensure the body class is set correctly on mount
                document.body.classList.toggle('dark-mode', this.isDark);
            }
        }).mount('#CRTApp');
    </script>
</body>
</html>